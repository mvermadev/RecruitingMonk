{"ast":null,"code":"\"use strict\";\n\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\n\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n    label: 0,\n    sent: function () {\n      if (t[0] & 1) throw t[1];\n      return t[1];\n    },\n    trys: [],\n    ops: []\n  },\n      f,\n      y,\n      t,\n      g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n\n        case 7:\n          op = _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n\n            _.ops.push(op);\n\n            break;\n          }\n\n          if (t[2]) _.ops.pop();\n\n          _.trys.pop();\n\n          continue;\n      }\n\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\n\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar cheerio_without_node_native_1 = __importDefault(require(\"cheerio-without-node-native\"));\n\nvar cross_fetch_1 = require(\"cross-fetch\");\n\nvar url_1 = __importDefault(require(\"url\"));\n\nvar constants_1 = require(\"./constants\");\n\nfunction getTitle(doc) {\n  var title = doc(\"meta[property='og:title']\").attr(\"content\");\n\n  if (!title) {\n    title = doc(\"title\").text();\n  }\n\n  return title;\n}\n\nfunction getSiteName(doc) {\n  var siteName = doc(\"meta[property='og:site_name']\").attr(\"content\");\n  return siteName;\n}\n\nfunction getDescription(doc) {\n  var description = doc(\"meta[name=description]\").attr(\"content\");\n\n  if (description === undefined) {\n    description = doc(\"meta[name=Description]\").attr(\"content\");\n  }\n\n  if (description === undefined) {\n    description = doc(\"meta[property='og:description']\").attr(\"content\");\n  }\n\n  return description;\n}\n\nfunction getMediaType(doc) {\n  var node = doc(\"meta[name=medium]\");\n\n  if (node.length) {\n    var content = node.attr(\"content\");\n    return content === \"image\" ? \"photo\" : content;\n  }\n\n  return doc(\"meta[property='og:type']\").attr(\"content\");\n}\n\nfunction getImages(doc, rootUrl, imagesPropertyType) {\n  var images = [];\n  var nodes;\n  var src;\n  var dic = {};\n  var imagePropertyType = imagesPropertyType !== null && imagesPropertyType !== void 0 ? imagesPropertyType : \"og\";\n  nodes = doc(\"meta[property='\" + imagePropertyType + \":image']\");\n\n  if (nodes.length) {\n    nodes.each(function (_, node) {\n      src = node.attribs.content;\n\n      if (src) {\n        src = url_1.default.resolve(rootUrl, src);\n        images.push(src);\n      }\n    });\n  }\n\n  if (images.length <= 0 && !imagesPropertyType) {\n    src = doc(\"link[rel=image_src]\").attr(\"href\");\n\n    if (src) {\n      src = url_1.default.resolve(rootUrl, src);\n      images = [src];\n    } else {\n      nodes = doc(\"img\");\n\n      if (nodes.length) {\n        dic = {};\n        images = [];\n        nodes.each(function (_, node) {\n          src = node.attribs.src;\n\n          if (src && !dic[src]) {\n            dic[src] = true; // width = node.attribs.width;\n            // height = node.attribs.height;\n\n            images.push(url_1.default.resolve(rootUrl, src));\n          }\n        });\n      }\n    }\n  }\n\n  return images;\n}\n\nfunction getVideos(doc) {\n  var videos = [];\n  var nodeTypes;\n  var nodeSecureUrls;\n  var nodeType;\n  var nodeSecureUrl;\n  var video;\n  var videoType;\n  var videoSecureUrl;\n  var width;\n  var height;\n  var videoObj;\n  var index;\n  var nodes = doc(\"meta[property='og:video']\");\n  var length = nodes.length;\n\n  if (length) {\n    nodeTypes = doc(\"meta[property='og:video:type']\");\n    nodeSecureUrls = doc(\"meta[property='og:video:secure_url']\");\n    width = doc(\"meta[property='og:video:width']\").attr(\"content\");\n    height = doc(\"meta[property='og:video:height']\").attr(\"content\");\n\n    for (index = 0; index < length; index += 1) {\n      video = nodes[index].attribs.content;\n      nodeType = nodeTypes[index];\n      videoType = nodeType ? nodeType.attribs.content : null;\n      nodeSecureUrl = nodeSecureUrls[index];\n      videoSecureUrl = nodeSecureUrl ? nodeSecureUrl.attribs.content : null;\n      videoObj = {\n        url: video,\n        secureUrl: videoSecureUrl,\n        type: videoType,\n        width: width,\n        height: height\n      };\n\n      if (videoType && videoType.indexOf(\"video/\") === 0) {\n        videos.splice(0, 0, videoObj);\n      } else {\n        videos.push(videoObj);\n      }\n    }\n  }\n\n  return videos;\n} // returns default favicon (//hostname/favicon.ico) for a url\n\n\nfunction getDefaultFavicon(rootUrl) {\n  return url_1.default.resolve(rootUrl, \"/favicon.ico\");\n} // returns an array of URL's to favicon images\n\n\nfunction getFavicons(doc, rootUrl) {\n  var images = [];\n  var nodes = [];\n  var src;\n  var relSelectors = [\"rel=icon\", \"rel=\\\"shortcut icon\\\"\", \"rel=apple-touch-icon\"];\n  relSelectors.forEach(function (relSelector) {\n    // look for all icon tags\n    nodes = doc(\"link[\" + relSelector + \"]\"); // collect all images from icon tags\n\n    if (nodes.length) {\n      nodes.each(function (_, node) {\n        src = node.attribs.href;\n\n        if (src) {\n          src = url_1.default.resolve(rootUrl, src);\n          images.push(src);\n        }\n      });\n    }\n  }); // if no icon images, use default favicon location\n\n  if (images.length <= 0) {\n    images.push(getDefaultFavicon(rootUrl));\n  }\n\n  return images;\n}\n\nfunction parseImageResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"image\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\n\nfunction parseAudioResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"audio\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\n\nfunction parseVideoResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"video\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\n\nfunction parseApplicationResponse(url, contentType) {\n  return {\n    url: url,\n    mediaType: \"application\",\n    contentType: contentType,\n    favicons: [getDefaultFavicon(url)]\n  };\n}\n\nfunction parseTextResponse(body, url, options, contentType) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  var doc = cheerio_without_node_native_1.default.load(body);\n  return {\n    url: url,\n    title: getTitle(doc),\n    siteName: getSiteName(doc),\n    description: getDescription(doc),\n    mediaType: getMediaType(doc) || \"website\",\n    contentType: contentType,\n    images: getImages(doc, url, options.imagesPropertyType),\n    videos: getVideos(doc),\n    favicons: getFavicons(doc, url)\n  };\n}\n\nfunction parseUnknownResponse(body, url, options, contentType) {\n  if (options === void 0) {\n    options = {};\n  }\n\n  return parseTextResponse(body, url, options, contentType);\n}\n\nfunction getLinkPreview(text, options) {\n  var _a, _b;\n\n  return __awaiter(this, void 0, void 0, function () {\n    var detectedUrl, fetchOptions, response, finalUrl, contentType, htmlString_1, htmlString_2, htmlString, e_1;\n    return __generator(this, function (_c) {\n      switch (_c.label) {\n        case 0:\n          if (!text || typeof text !== \"string\") {\n            throw new Error(\"link-preview-js did not receive a valid url or text\");\n          }\n\n          detectedUrl = text.replace(/\\n/g, \" \").split(\" \").find(function (token) {\n            return constants_1.CONSTANTS.REGEX_VALID_URL.test(token);\n          });\n\n          if (!detectedUrl) {\n            throw new Error(\"link-preview-js did not receive a valid a url or text\");\n          }\n\n          fetchOptions = {\n            headers: (_b = (_a = options) === null || _a === void 0 ? void 0 : _a.headers, _b !== null && _b !== void 0 ? _b : {})\n          };\n          _c.label = 1;\n\n        case 1:\n          _c.trys.push([1, 8,, 9]);\n\n          return [4\n          /*yield*/\n          , cross_fetch_1.fetch(detectedUrl, fetchOptions)];\n\n        case 2:\n          response = _c.sent();\n          finalUrl = response.url;\n          contentType = response.headers.get(\"content-type\");\n          if (!!contentType) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , response.text()];\n\n        case 3:\n          htmlString_1 = _c.sent();\n          return [2\n          /*return*/\n          , parseUnknownResponse(htmlString_1, finalUrl, options)];\n\n        case 4:\n          if (contentType instanceof Array) {\n            // eslint-disable-next-line prefer-destructuring\n            contentType = contentType[0];\n          } // parse response depending on content type\n\n\n          if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_IMAGE.test(contentType)) {\n            return [2\n            /*return*/\n            , parseImageResponse(finalUrl, contentType)];\n          }\n\n          if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_AUDIO.test(contentType)) {\n            return [2\n            /*return*/\n            , parseAudioResponse(finalUrl, contentType)];\n          }\n\n          if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_VIDEO.test(contentType)) {\n            return [2\n            /*return*/\n            , parseVideoResponse(finalUrl, contentType)];\n          }\n\n          if (!constants_1.CONSTANTS.REGEX_CONTENT_TYPE_TEXT.test(contentType)) return [3\n          /*break*/\n          , 6];\n          return [4\n          /*yield*/\n          , response.text()];\n\n        case 5:\n          htmlString_2 = _c.sent();\n          return [2\n          /*return*/\n          , parseTextResponse(htmlString_2, finalUrl, options, contentType)];\n\n        case 6:\n          if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_APPLICATION.test(contentType)) {\n            return [2\n            /*return*/\n            , parseApplicationResponse(finalUrl, contentType)];\n          }\n\n          return [4\n          /*yield*/\n          , response.text()];\n\n        case 7:\n          htmlString = _c.sent();\n          return [2\n          /*return*/\n          , parseUnknownResponse(htmlString, finalUrl, options)];\n\n        case 8:\n          e_1 = _c.sent();\n          throw new Error(\"link-preview-js could not fetch link information \" + e_1.toString());\n\n        case 9:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nexports.getLinkPreview = getLinkPreview;","map":{"version":3,"sources":["/home/jt/Documents/Monk Works/RecruitingMonk/F-End/node_modules/link-preview-js/build/index.js"],"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","__generator","body","_","label","sent","t","trys","ops","f","y","g","verb","Symbol","iterator","n","v","op","TypeError","call","pop","length","push","__importDefault","mod","__esModule","Object","defineProperty","exports","cheerio_without_node_native_1","require","cross_fetch_1","url_1","constants_1","getTitle","doc","title","attr","text","getSiteName","siteName","getDescription","description","undefined","getMediaType","node","content","getImages","rootUrl","imagesPropertyType","images","nodes","src","dic","imagePropertyType","each","attribs","default","getVideos","videos","nodeTypes","nodeSecureUrls","nodeType","nodeSecureUrl","video","videoType","videoSecureUrl","width","height","videoObj","index","url","secureUrl","type","indexOf","splice","getDefaultFavicon","getFavicons","relSelectors","forEach","relSelector","href","parseImageResponse","contentType","mediaType","favicons","parseAudioResponse","parseVideoResponse","parseApplicationResponse","parseTextResponse","options","load","parseUnknownResponse","getLinkPreview","_a","_b","detectedUrl","fetchOptions","response","finalUrl","htmlString_1","htmlString_2","htmlString","e_1","_c","Error","replace","split","find","token","CONSTANTS","REGEX_VALID_URL","test","headers","fetch","get","Array","REGEX_CONTENT_TYPE_IMAGE","REGEX_CONTENT_TYPE_AUDIO","REGEX_CONTENT_TYPE_VIDEO","REGEX_CONTENT_TYPE_TEXT","REGEX_CONTENT_TYPE_APPLICATION","toString"],"mappings":"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","sourcesContent":["\"use strict\";\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nvar cheerio_without_node_native_1 = __importDefault(require(\"cheerio-without-node-native\"));\nvar cross_fetch_1 = require(\"cross-fetch\");\nvar url_1 = __importDefault(require(\"url\"));\nvar constants_1 = require(\"./constants\");\nfunction getTitle(doc) {\n    var title = doc(\"meta[property='og:title']\").attr(\"content\");\n    if (!title) {\n        title = doc(\"title\").text();\n    }\n    return title;\n}\nfunction getSiteName(doc) {\n    var siteName = doc(\"meta[property='og:site_name']\").attr(\"content\");\n    return siteName;\n}\nfunction getDescription(doc) {\n    var description = doc(\"meta[name=description]\").attr(\"content\");\n    if (description === undefined) {\n        description = doc(\"meta[name=Description]\").attr(\"content\");\n    }\n    if (description === undefined) {\n        description = doc(\"meta[property='og:description']\").attr(\"content\");\n    }\n    return description;\n}\nfunction getMediaType(doc) {\n    var node = doc(\"meta[name=medium]\");\n    if (node.length) {\n        var content = node.attr(\"content\");\n        return content === \"image\" ? \"photo\" : content;\n    }\n    return doc(\"meta[property='og:type']\").attr(\"content\");\n}\nfunction getImages(doc, rootUrl, imagesPropertyType) {\n    var images = [];\n    var nodes;\n    var src;\n    var dic = {};\n    var imagePropertyType = (imagesPropertyType !== null && imagesPropertyType !== void 0 ? imagesPropertyType : \"og\");\n    nodes = doc(\"meta[property='\" + imagePropertyType + \":image']\");\n    if (nodes.length) {\n        nodes.each(function (_, node) {\n            src = node.attribs.content;\n            if (src) {\n                src = url_1.default.resolve(rootUrl, src);\n                images.push(src);\n            }\n        });\n    }\n    if (images.length <= 0 && !imagesPropertyType) {\n        src = doc(\"link[rel=image_src]\").attr(\"href\");\n        if (src) {\n            src = url_1.default.resolve(rootUrl, src);\n            images = [src];\n        }\n        else {\n            nodes = doc(\"img\");\n            if (nodes.length) {\n                dic = {};\n                images = [];\n                nodes.each(function (_, node) {\n                    src = node.attribs.src;\n                    if (src && !dic[src]) {\n                        dic[src] = true;\n                        // width = node.attribs.width;\n                        // height = node.attribs.height;\n                        images.push(url_1.default.resolve(rootUrl, src));\n                    }\n                });\n            }\n        }\n    }\n    return images;\n}\nfunction getVideos(doc) {\n    var videos = [];\n    var nodeTypes;\n    var nodeSecureUrls;\n    var nodeType;\n    var nodeSecureUrl;\n    var video;\n    var videoType;\n    var videoSecureUrl;\n    var width;\n    var height;\n    var videoObj;\n    var index;\n    var nodes = doc(\"meta[property='og:video']\");\n    var length = nodes.length;\n    if (length) {\n        nodeTypes = doc(\"meta[property='og:video:type']\");\n        nodeSecureUrls = doc(\"meta[property='og:video:secure_url']\");\n        width = doc(\"meta[property='og:video:width']\").attr(\"content\");\n        height = doc(\"meta[property='og:video:height']\").attr(\"content\");\n        for (index = 0; index < length; index += 1) {\n            video = nodes[index].attribs.content;\n            nodeType = nodeTypes[index];\n            videoType = nodeType ? nodeType.attribs.content : null;\n            nodeSecureUrl = nodeSecureUrls[index];\n            videoSecureUrl = nodeSecureUrl ? nodeSecureUrl.attribs.content : null;\n            videoObj = {\n                url: video,\n                secureUrl: videoSecureUrl,\n                type: videoType,\n                width: width,\n                height: height,\n            };\n            if (videoType && videoType.indexOf(\"video/\") === 0) {\n                videos.splice(0, 0, videoObj);\n            }\n            else {\n                videos.push(videoObj);\n            }\n        }\n    }\n    return videos;\n}\n// returns default favicon (//hostname/favicon.ico) for a url\nfunction getDefaultFavicon(rootUrl) {\n    return url_1.default.resolve(rootUrl, \"/favicon.ico\");\n}\n// returns an array of URL's to favicon images\nfunction getFavicons(doc, rootUrl) {\n    var images = [];\n    var nodes = [];\n    var src;\n    var relSelectors = [\n        \"rel=icon\",\n        \"rel=\\\"shortcut icon\\\"\",\n        \"rel=apple-touch-icon\",\n    ];\n    relSelectors.forEach(function (relSelector) {\n        // look for all icon tags\n        nodes = doc(\"link[\" + relSelector + \"]\");\n        // collect all images from icon tags\n        if (nodes.length) {\n            nodes.each(function (_, node) {\n                src = node.attribs.href;\n                if (src) {\n                    src = url_1.default.resolve(rootUrl, src);\n                    images.push(src);\n                }\n            });\n        }\n    });\n    // if no icon images, use default favicon location\n    if (images.length <= 0) {\n        images.push(getDefaultFavicon(rootUrl));\n    }\n    return images;\n}\nfunction parseImageResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"image\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseAudioResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"audio\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseVideoResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"video\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseApplicationResponse(url, contentType) {\n    return {\n        url: url,\n        mediaType: \"application\",\n        contentType: contentType,\n        favicons: [getDefaultFavicon(url)],\n    };\n}\nfunction parseTextResponse(body, url, options, contentType) {\n    if (options === void 0) { options = {}; }\n    var doc = cheerio_without_node_native_1.default.load(body);\n    return {\n        url: url,\n        title: getTitle(doc),\n        siteName: getSiteName(doc),\n        description: getDescription(doc),\n        mediaType: getMediaType(doc) || \"website\",\n        contentType: contentType,\n        images: getImages(doc, url, options.imagesPropertyType),\n        videos: getVideos(doc),\n        favicons: getFavicons(doc, url),\n    };\n}\nfunction parseUnknownResponse(body, url, options, contentType) {\n    if (options === void 0) { options = {}; }\n    return parseTextResponse(body, url, options, contentType);\n}\nfunction getLinkPreview(text, options) {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function () {\n        var detectedUrl, fetchOptions, response, finalUrl, contentType, htmlString_1, htmlString_2, htmlString, e_1;\n        return __generator(this, function (_c) {\n            switch (_c.label) {\n                case 0:\n                    if (!text || typeof text !== \"string\") {\n                        throw new Error(\"link-preview-js did not receive a valid url or text\");\n                    }\n                    detectedUrl = text\n                        .replace(/\\n/g, \" \")\n                        .split(\" \")\n                        .find(function (token) { return constants_1.CONSTANTS.REGEX_VALID_URL.test(token); });\n                    if (!detectedUrl) {\n                        throw new Error(\"link-preview-js did not receive a valid a url or text\");\n                    }\n                    fetchOptions = { headers: (_b = (_a = options) === null || _a === void 0 ? void 0 : _a.headers, (_b !== null && _b !== void 0 ? _b : {})) };\n                    _c.label = 1;\n                case 1:\n                    _c.trys.push([1, 8, , 9]);\n                    return [4 /*yield*/, cross_fetch_1.fetch(detectedUrl, fetchOptions)];\n                case 2:\n                    response = _c.sent();\n                    finalUrl = response.url;\n                    contentType = response.headers.get(\"content-type\");\n                    if (!!contentType) return [3 /*break*/, 4];\n                    return [4 /*yield*/, response.text()];\n                case 3:\n                    htmlString_1 = _c.sent();\n                    return [2 /*return*/, parseUnknownResponse(htmlString_1, finalUrl, options)];\n                case 4:\n                    if (contentType instanceof Array) {\n                        // eslint-disable-next-line prefer-destructuring\n                        contentType = contentType[0];\n                    }\n                    // parse response depending on content type\n                    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_IMAGE.test(contentType)) {\n                        return [2 /*return*/, parseImageResponse(finalUrl, contentType)];\n                    }\n                    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_AUDIO.test(contentType)) {\n                        return [2 /*return*/, parseAudioResponse(finalUrl, contentType)];\n                    }\n                    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_VIDEO.test(contentType)) {\n                        return [2 /*return*/, parseVideoResponse(finalUrl, contentType)];\n                    }\n                    if (!constants_1.CONSTANTS.REGEX_CONTENT_TYPE_TEXT.test(contentType)) return [3 /*break*/, 6];\n                    return [4 /*yield*/, response.text()];\n                case 5:\n                    htmlString_2 = _c.sent();\n                    return [2 /*return*/, parseTextResponse(htmlString_2, finalUrl, options, contentType)];\n                case 6:\n                    if (constants_1.CONSTANTS.REGEX_CONTENT_TYPE_APPLICATION.test(contentType)) {\n                        return [2 /*return*/, parseApplicationResponse(finalUrl, contentType)];\n                    }\n                    return [4 /*yield*/, response.text()];\n                case 7:\n                    htmlString = _c.sent();\n                    return [2 /*return*/, parseUnknownResponse(htmlString, finalUrl, options)];\n                case 8:\n                    e_1 = _c.sent();\n                    throw new Error(\"link-preview-js could not fetch link information \" + e_1.toString());\n                case 9: return [2 /*return*/];\n            }\n        });\n    });\n}\nexports.getLinkPreview = getLinkPreview;\n"]},"metadata":{},"sourceType":"script"}